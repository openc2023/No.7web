# No.7 开发说明

## 版本：1.0 (MVP)  
项目代号：No.7  
核心定位：面向普通用户的、基于组件化与 GitHub 存储的可视化静态建站引擎。

## 一、项目愿景 (Vision)

### 1.1 核心理念
No.7 的诞生是为了打破“程序员工具”与“傻瓜建站”之间的壁垒。它坚信：

- **去代码化**：用户不需要懂 HTML/CSS 或 Markdown，一切皆可视。
- **去数据库化**：没有 MySQL，所有数据以 JSON 和文件形式存储，轻量且易迁移。
- **私有与自由**：数据完全掌握在用户手中的 GitHub 仓库里，而不是被锁在 SaaS 平台。

### 1.2 目标用户画像
- **非技术创作者**：设计师、摄影师、文字工作者。
- **需求**：想要一个独一无二的个人网站，想要像整理电脑文件夹一样管理网站结构，像拼积木一样搭建页面。

## 二、系统架构设计 (System Architecture)

No.7 采用 "Flat-File Headless CMS" 架构。

### 2.1 数据层 (Data)
- `site.json`：全站的“大脑”，存储菜单结构、全局配置。
- `/components`：原子化的组件库。
- `/pages-source`：存储每个页面的原始内容（HTML 片段）。

### 2.2 逻辑层 (Logic - PHP)
- **Scanner**：自动扫描组件文件夹，注册到编辑器。
- **Builder**：读取 JSON + 组件 + 页面内容 -> 拼装成完整 HTML。
- **Deployer**：执行 Git 命令同步到 GitHub。
- **Uploader**：处理媒体文件上传和管理。

### 2.3 表现层 (View - Browser)
- **Editor**：基于 GrapesJS 的可视化画布。
- **Structure Manager**：基于 SortableJS 的树形菜单管理。
- **Component Panel**：组件选择和分类展示。
- **Media Library**：媒体文件管理界面。

### 2.4 技术栈
| 类别 | 技术 | 版本 | 用途 |
|------|------|------|------|
| 后端 | PHP | 7.4+ | 核心逻辑处理 |
| 前端框架 | GrapesJS | 0.21+ | 可视化编辑器 |
| 前端UI | SortableJS | 1.15+ | 拖拽排序功能 |
| 前端UI | Bootstrap | 5.0+ | 编辑器界面样式 |
| 存储 | Git | 2.0+ | 版本控制和部署 |
| 存储 | JSON | - | 配置和数据存储 |

## 三、核心功能模块 (Functional Modules)

### 3.1 全局结构管理器 (The Structure Tree)
**痛点解决**：普通人不懂路由和文件路径，只懂“目录”和“层级”。

**功能细节**：
- 左侧常驻树形菜单。
- 拖拽排序：上下拖动改变菜单顺序。
- 层级嵌套：向右拖动自动变为子菜单（无限层级）。
- 实时联动：拖动结束瞬间，右侧预览区的导航栏自动刷新。
- 快捷操作：右键菜单提供添加、编辑、删除页面功能。

### 3.2 智能组件系统 (Auto-Scan Component System)
**痛点解决**：无需手动注册代码，文件即组件。

**实现逻辑**：
- 用户将写好的 HTML/CSS 放入 `/components/` 文件夹。
- 编辑器启动时，PHP 自动扫描该目录下的 `config.json`。
- 组件自动出现在编辑器的“积木堆”里，分类明确（如：页头、展示、营销）。
- 组件预览：每个组件显示缩略图，方便用户选择。

### 3.3 可视化画布 (The Canvas)
**痛点解决**：抛弃 Markdown，所见即所得。

**功能细节**：
- 文本编辑：点击文字直接修改。
- 媒体管理：双击图片弹出本地上传窗口。
- 组件拼接：从侧边栏拖入组件，自由上下调整位置。
- 安全锁：用户只能修改内容，无法破坏布局代码（HTML 结构被锁定）。
- 撤销/重做：支持多级操作回退。

### 3.4 一键发布引擎 (The Engine)
**痛点解决**：无需命令行，无需配置 CI/CD。

**工作流**：
1. 点击“保存并发布”。
2. 后端生成静态 HTML 文件 (index.html 等) 到发布目录。
3. 后端静默执行 git push。
4. 前端显示进度条，提示发布成功。

### 3.5 媒体库管理
**痛点解决**：方便用户管理和使用网站图片资源。

**功能细节**：
- 本地上传：支持批量上传图片。
- 预览缩略图：直观展示所有媒体文件。
- 拖拽使用：直接拖拽图片到画布使用。
- 自动优化：上传时自动压缩图片大小。

## 四、详细技术规范 (Technical Specs)

### 4.1 目录结构 (Directory Map)
```
/Project-No7
├── /admin              # 编辑器核心
│   ├── api/            # PHP 接口 (scan, save, upload, deploy)
│   ├── assets/         # 编辑器用的 JS/CSS
│   └── index.php       # 编辑器主界面
├── /config
│   └── site.json       # 【核心数据库】存储菜单树、SEO信息
├── /components         # 【组件库】自动扫描
│   ├── /hero-header    # 组件文件夹
│   │   ├── config.json # 组件名、图标、分类
│   │   ├── template.html
│   │   └── style.css
│   └── ...
├── /pages-source       # 页面原始内容 (只存 Body，不存头尾)
├── /public             # 【输出目录】Git 仓库根目录
│   ├── index.html      # 生成后的最终网页
│   ├── assets/         # 图片资源
│   └── ...
├── generator.php       # 静态生成脚本
├── .gitignore          # Git忽略配置
└── README.md           # 项目说明
```

### 4.2 数据结构标准

#### 4.2.1 site.json
```json
{
  "global": {
    "title": "No.7 Studio",
    "logo": "logo.png",
    "favicon": "favicon.ico",
    "description": "这是一个基于No.7构建的网站",
    "keywords": "No.7, 静态网站, 可视化编辑"
  },
  "menu": [
    {
      "id": "uuid_1",
      "label": "首页",
      "url": "index.html",
      "children": []
    },
    {
      "id": "uuid_2",
      "label": "作品",
      "url": "works.html",
      "children": [
        {
          "id": "uuid_3",
          "label": "插画",
          "url": "works/art.html"
        }
      ]
    }
  ]
}
```

#### 4.2.2 组件 config.json
```json
{
  "name": "组件中文显示名",
  "category": "组件分类",
  "icon": "fa-solid fa-tag",
  "version": "1.0"
}
```

### 4.3 No.7 Studio 组件开发白皮书 (v1.0)

任何想要加入组件库的文件夹，都必须严格遵守以下 5 大核心规范，否则会导致样式互相冲突、变量命名混乱、GrapesJS 无法正确识别等问题。

#### 4.3.1 📂 目录与命名规范 (Directory & Naming)
所有组件必须放在 `/components` 目录下，且每个组件拥有唯一的英文 ID。

- **文件夹命名**：只能使用小写英文和短横线 (kebab-case)。
  ✅ 正确：`hero-banner`, `price-card-glass`
  ❌ 错误：`HeroBanner`, `价格组件`, `card_01`
  
- **文件结构**：每个组件文件夹内必须包含以下文件：
  ```
  /components/my-component-id/
    ├── config.json      (身份证：定义名字、分类、图标)
    ├── template.html    (肉体：HTML结构 + 局部CSS)
    └── preview.png      (可选：在编辑器里显示的缩略图，如果不放就显示图标)
  ```

#### 4.3.2 📝 配置规范 (Config Protocol)
`config.json` 是组件被 PHP 扫描器识别的唯一凭证。

```json
{
  "name": "组件中文显示名",     // 例如：玻璃价格表
  "category": "组件分类",       // 必须是：布局组件 | 容器组件 | 内容组件 | 展示组件
  "icon": "fa-solid fa-tag",   // 必须使用 FontAwesome 6 的类名
  "version": "1.0"             // 可选：版本号
}
```

#### 4.3.3 🎨 样式隔离规范 (CSS Scoping) - 最重要！
为了防止组件 A 的 CSS 污染组件 B，必须遵循 BEM (Block Element Modifier) 命名法，并强制加上组件 ID 前缀。

- **根容器类名**：必须是 `.comp-[文件夹名]-wrapper`。
- **内部元素**：必须是 `.comp-[文件夹名]-[元素名]`。

❌ 严禁写法（会炸样式）：
```css
/* 禁止写通用标签！这会把整个网站的 h1 都改了 */
h1 { font-size: 20px; }
.card { background: red; } /* 名字太普通，容易冲突 */
```

✅ 标准写法：
```html
<div class="comp-pricing-table-wrapper">
    <style>
        /* 这里的样式只属于这个组件 */
        .comp-pricing-table-wrapper h1 { font-size: 20px; }
        .comp-pricing-table-card { background: red; }
    </style>
    ...
</div>
```

#### 4.3.4 🔮 视觉统一规范 (Visual Consistency)
为了让所有组件看起来都像一套 UI，严禁写死颜色和圆角，必须调用我们在 `:root` 里定义的全局 CSS 变量。

| 属性 | 必须使用的变量 | 说明 |
|------|----------------|------|
| 背景色 | `var(--card-bg)` | 自动适配全局透明度 |
| 磨砂 | `backdrop-filter: blur(var(--blur-strength))` | 自动适配全局磨砂力度 |
| 圆角 | `var(--border-radius)` | 自动适配全局圆角风格 |
| 边框 | `var(--border-color)` | 保持玻璃边缘质感 |
| 字体 | `var(--font-family)` | 保持全站字体统一 |

**例外**：如果该组件就是要特殊（比如是个黑色的代码块），可以在组件内部重新定义变量覆盖全局。

#### 4.3.5 🏗 编辑器交互规范 (GrapesJS Attributes)
为了让用户知道哪里能点、哪里能改字、哪里能拖东西进去，必须在 HTML 标签上加 `data-gjs-*` 属性。

- **文本可编辑**：`data-gjs-editable="true"` 加在 `h1`, `p`, `span`, `div` 上。
- **不可删除**：`data-gjs-removable="false"` 加在结构性元素上（比如卡片的头部），防止用户手抖删坏了布局。
- **容器模式**：`data-gjs-droppable="true"` 如果你做的是“矩阵容器”或“组卡片”，必须加这个，否则别的组件拖不进去。
- **自定义名称**：`data-gjs-name="标题区域"` 在编辑器图层面板里显示的名字，方便用户查找。

#### 4.3.6 🏆 标准组件范例：玻璃价格卡片

下面是一个严格符合上述所有规范的组件示例。你可以直接复制作为开发模板。

**路径**：`/components/pricing-glass/`

1. **config.json**
```json
{
  "name": "玻璃价格卡片",
  "category": "展示组件",
  "icon": "fa-solid fa-tags"
}
```

2. **template.html**
```html
<div class="comp-pricing-glass-wrapper">
    
    <style>
        /* 2. 样式隔离：所有 CSS 都带前缀 */
        .comp-pricing-glass-wrapper {
            /* 3. 调用全局变量 */
            background: var(--card-bg, rgba(255,255,255,0.1));
            backdrop-filter: blur(var(--blur-strength, 20px));
            border-radius: var(--border-radius, 16px);
            border: 1px solid var(--border-color, rgba(255,255,255,0.2));
            padding: 30px;
            text-align: center;
            color: var(--text-color, white);
            transition: transform 0.3s;
        }
        
        .comp-pricing-glass-wrapper:hover {
            transform: translateY(-5px); /* 简单的交互动效 */
        }

        .comp-pricing-glass-price {
            font-size: 40px;
            font-weight: bold;
            margin: 20px 0;
            color: var(--accent-color, #3b82f6); /* 使用全局强调色 */
        }
    </style>

    <h3 data-gjs-editable="true" data-gjs-name="套餐名称">基础版</h3>
    
    <div class="comp-pricing-glass-price" data-gjs-editable="true">$99</div>
    
    <p data-gjs-editable="true">适合个人开发者使用</p>
    
    <button style="
        background: var(--accent-color);
        border:none;
        padding:10px 20px;
        border-radius:4px;
        color:white;
        cursor:pointer;
        margin-top: 15px;
    ">立即购买</button>

</div>
```

#### 4.3.7 组件开发建议
建议你可以把这份规范写成一个 `README.md` 放在 `/components` 根目录下，时刻提醒自己（或者未来的协作者）遵循规范。

只要按照这个规范写，你的编辑器就算装入 100 个组件，也不会出现样式冲突、命名混乱等问题。

### 4.4 API 接口规范

#### 4.4.1 组件扫描接口
- **URL**：`/admin/api/scan-components.php`
- **Method**：GET
- **Response**：
```json
{
  "status": "success",
  "components": [
    {
      "name": "Hero Header",
      "category": "Header",
      "icon": "fas fa-heading"
    }
  ]
}
```

#### 4.4.2 保存页面接口
- **URL**：`/admin/api/save-page.php`
- **Method**：POST
- **Params**：
  - `page_id`：页面ID
  - `content`：页面内容（HTML）
- **Response**：
```json
{
  "status": "success",
  "message": "Page saved successfully"
}
```

#### 4.4.3 发布站点接口
- **URL**：`/admin/api/deploy.php`
- **Method**：POST
- **Response**：
```json
{
  "status": "success",
  "message": "Site deployed successfully",
  "log": "Git push output"
}
```

## 五、开发路线图 (Roadmap)

### 阶段一：骨架搭建 (The Skeleton) - 1周
**目标**：跑通数据流，实现菜单管理。

**任务**：
1. 建立完整的文件目录结构。
2. 编写 `site.json` 配置文件。
3. 完成 Structure Manager：
   - 前端用 SortableJS 读取 JSON 并渲染成可拖拽列表。
   - 后端 PHP 实现保存回 JSON。
4. 实现基础的编辑器界面布局。

### 阶段二：组件引擎 (The Heart) - 2周
**目标**：实现组件自动扫描与加载。

**任务**：
1. 建立 `/components` 规范和示例组件。
2. 编写 PHP 扫描脚本 (`scan_components.php`)。
3. 集成 GrapesJS，使其能动态加载 PHP 返回的组件列表。
4. 实现组件拖拽到画布功能。

### 阶段三：静态生成 (The Brain) - 1周
**目标**：把零散的数据拼成完整的网页。

**任务**：
1. 编写 `generator.php` 静态生成脚本。
2. 逻辑：读取 `site.json` 生成导航栏 HTML -> 读取页面 Body -> 拼接 Header+Body+Footer -> 写入 `/public`。
3. 实现页面预览功能。

### 阶段四：连接世界 (The Wings) - 1周
**目标**：实现 GitHub 同步和媒体管理。

**任务**：
1. 编写 Git 操作 PHP 脚本 (`exec('git push...')`)。
2. 前端添加“一键发布”按钮与状态反馈。
3. 开发图片上传接口和媒体库管理。
4. 实现媒体文件拖拽到画布功能。

### 阶段五：UI/UX 润色 (The Skin) - 1周
**目标**：让普通人觉得好用。

**任务**：
1. 美化编辑器界面（暗色模式、精美图标）。
2. 增加“组件预览图”功能。
3. 实现简单的登录验证。
4. 添加操作指引和提示信息。
5. 优化响应式设计，适配不同屏幕尺寸。

### 阶段六：测试和优化 - 1周
**目标**：确保系统稳定可用。

**任务**：
1. 功能测试：测试所有核心功能。
2. 性能测试：优化生成速度和编辑器响应。
3. 兼容性测试：测试不同浏览器和设备。
4. 安全性测试：检查潜在的安全漏洞。
5. 编写使用文档。

## 六、安装和部署指南

### 6.1 环境要求
- PHP 7.4+（支持 fileinfo、gd 扩展）
- Git 2.0+
- Web 服务器（Apache/Nginx）
- 支持 .htaccess（Apache）或相应的 Nginx 配置

### 6.2 安装步骤
1. 克隆仓库：`git clone <repository-url>`
2. 进入项目目录：`cd Project-No7`
3. 初始化 Git 仓库：`git init`（如果是新项目）
4. 配置 `site.json` 基本信息
5. 设置 Web 服务器根目录指向项目目录
6. 访问 `/admin` 进入编辑器

### 6.3 GitHub 配置
1. 在 GitHub 创建一个新的仓库
2. 配置本地 Git 远程仓库：`git remote add origin <github-repo-url>`
3. 确保服务器有 GitHub 访问权限（使用 SSH 密钥）

## 七、安全考虑

### 7.1 输入验证
- 所有用户输入必须经过严格验证和过滤
- 防止 XSS 攻击：对 HTML 内容进行安全过滤
- 防止 CSRF 攻击：使用 CSRF 令牌保护 API

### 7.2 文件安全
- 限制文件上传类型：只允许图片和文档
- 限制文件大小：单文件不超过 10MB
- 防止路径遍历攻击：严格验证文件路径
- 媒体文件存储在非执行目录

### 7.3 访问控制
- 编辑器需要登录验证
- 限制 API 访问频率，防止暴力攻击
- 定期备份数据

### 7.4 Git 安全
- 使用 SSH 密钥而非 HTTP 密码
- 定期更新 Git 版本
- 避免在代码中硬编码 Git 凭证

## 八、扩展性设计

### 8.1 插件系统
- 设计插件接口，支持第三方扩展
- 插件可以扩展组件库、添加新功能

### 8.2 主题支持
- 支持多主题切换
- 主题可以包含不同的组件样式和布局

### 8.3 API 开放
- 提供 RESTful API，支持第三方工具集成
- 支持 Webhooks，实现自动化工作流

## 九、测试策略

### 9.1 单元测试
- 使用 PHPUnit 对核心逻辑进行单元测试
- 测试组件扫描、静态生成等功能

### 9.2 集成测试
- 测试前后端交互流程
- 测试发布流程的完整性

### 9.3 端到端测试
- 使用 Cypress 进行端到端测试
- 测试完整的用户操作流程

### 9.4 性能测试
- 测试编辑器响应速度
- 测试静态生成速度
- 测试大型站点的处理能力

## 十、维护和支持

### 10.1 版本管理
- 采用语义化版本控制（MAJOR.MINOR.PATCH）
- 定期发布更新和安全补丁

### 10.2 日志记录
- 记录系统操作日志
- 记录错误和异常信息
- 记录发布历史

### 10.3 备份策略
- 定期备份 `site.json` 和 `/pages-source`
- 利用 Git 进行版本控制和回滚
- 建议用户定期导出数据备份

## 十一、未来规划

1. **多语言支持**：实现网站多语言版本管理
2. **SEO 工具**：内置 SEO 优化功能
3. **动画效果**：支持添加页面动画和过渡效果
4. **协作功能**：支持多人协作编辑
5. **模板市场**：提供组件和主题模板市场
6. **云存储集成**：支持 AWS S3、阿里云 OSS 等云存储服务
7. **SSR 支持**：支持服务端渲染，提高首屏加载速度

## 十二、贡献指南

1. Fork 本仓库
2. 创建功能分支：`git checkout -b feature/AmazingFeature`
3. 提交更改：`git commit -m 'Add some AmazingFeature'`
4. 推送到分支：`git push origin feature/AmazingFeature`
5. 打开 Pull Request

## 十三、许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

---

**No.7** - 让每个人都能轻松创建自己的网站！ 🚀